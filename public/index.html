<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tottonoe</title>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: transparent;
        color: #333;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .reset-button {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(244, 67, 54, 0.8);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s;
        z-index: 1000;
        -webkit-app-region: no-drag;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .reset-button:hover {
        background: rgba(244, 67, 54, 0.95);
        transform: scale(1.05);
      }

      .reset-button .material-icons {
        font-size: 18px;
      }

      .header {
        padding: 20px;
        text-align: center;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 0 0 15px 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        -webkit-app-region: drag;
        margin-bottom: 10px;
      }

      .header * {
        -webkit-app-region: no-drag;
      }

      .header h1 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        color: #333;
      }

      .header h1 .material-icons {
        font-size: 28px;
      }

      .header p {
        opacity: 0.7;
        font-size: 14px;
        color: #666;
      }

      .main-content {
        flex: 1;
        padding: 10px 20px 20px;
        overflow-y: auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 15px 15px 0 0;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        margin-top: -10px;
      }

      .input-section {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .input-group {
        display: flex;
        gap: 0;
        align-items: stretch;
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(0, 0, 0, 0.12);
        border-radius: 12px;
        overflow: hidden;
      }

      /* input-group 内のデフォルト入力スタイル */
      .input-group input {
        flex: 1;
        padding: 14px 18px;
        background: rgba(255, 255, 255, 0.95);
        color: #333;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        outline: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      #userIntent,
      #taskPromptInput {
        flex: 1;
        padding: 14px 16px;
        padding-left: 60px;
        background: rgba(255, 255, 255, 0.92);
        color: #1f2937;
        border: none;
        font-size: 14px;
        outline: none;
      }

      #userIntent::placeholder,
      #taskPromptInput::placeholder {
        color: #9ca3af;
      }

      button {
        padding: 12px 24px;
        background: #111;
        color: #fff;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.25s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      button .material-icons {
        font-size: 18px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        background: #000;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 15px;
      }

      /* ヒーロー検索の一体型ボタン */
      .inline-action-btn {
        background: #111;
        color: white;
        border-radius: 0 12px 12px 0;
        border-left: 1px solid rgba(0, 0, 0, 0.25);
        padding: 0 18px;
        min-width: 120px;
        position: relative;
        z-index: 2;
        pointer-events: auto;
      }

      .inline-action-btn:hover {
        filter: brightness(1.05);
      }

      .inline-success-btn {
        background: #111;
        color: white;
        border-radius: 0 12px 12px 0;
        border-left: 1px solid rgba(0, 0, 0, 0.25);
        padding: 0 18px;
        min-width: 110px;
        position: relative;
        z-index: 2;
        pointer-events: auto;
      }

      .inline-success-btn:hover {
        filter: brightness(1.05);
      }

      .inline-action-btn--middle {
        border-radius: 0;
        border-right: 1px solid rgba(255, 255, 255, 0.25);
      }

      .inline-secondary-btn {
        background: #111;
        color: white;
        border-left: 1px solid rgba(0, 0, 0, 0.25);
        border-radius: 0 12px 12px 0;
        padding: 0 14px;
        min-width: 96px;
      }

      .inline-secondary-btn:hover {
        background: rgba(255, 255, 255, 0.16);
      }

      /* 入力内アイコン */
      .input-with-icon {
        position: relative;
        flex: 1;
        display: flex;
      }

      .input-with-icon .material-icons {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        font-size: 22px;
        width: 24px;
        text-align: center;
        pointer-events: none;
        z-index: 2;
      }

      .input-with-icon input {
        padding-left: 60px;
      }

      /* プリセット名の入力にもアイコン余白を適用 */
      #presetNameInput {
        padding-left: 60px;
      }

      .quick-action {
        padding: 10px;
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: #333;
        font-size: 13px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .quick-action .material-icons {
        font-size: 16px;
      }

      .quick-action:hover {
        background: rgba(0, 122, 255, 0.1);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 122, 255, 0.2);
      }

      .status-section {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .status-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: #333;
      }

      .section-subtitle {
        margin-top: -6px;
        margin-bottom: 12px;
        color: rgba(255, 255, 255, 0.85);
        font-size: 12px;
      }

      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #4ade80;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .window-list {
        display: grid;
        gap: 8px;
      }

      .window-item {
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        gap: 10px;
      }

      .window-info {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
      }

      .app-info-btn {
        width: 18px;
        height: 18px;
        min-width: 18px;
        border-radius: 4px;
        background: rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(0, 0, 0, 0.12);
        color: #333;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 600;
        font-style: italic;
        font-family: Georgia, serif;
        margin-left: 6px;
        padding: 0;
        transition: all 0.2s;
        flex-shrink: 0;
      }

      .app-info-btn:hover {
        background: rgba(0, 0, 0, 0.08);
        border-color: rgba(0, 0, 0, 0.2);
        transform: scale(1.05);
      }

      .observation-item {
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        margin-bottom: 8px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .observation-item .material-icons {
        font-size: 18px;
        opacity: 0.8;
      }

      /* App Search Results */
      .app-search-item {
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.2s;
        cursor: pointer;
      }

      .app-search-item:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateX(5px);
      }

      .app-search-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
      }

      .app-search-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        object-fit: cover;
      }

      .app-search-icon-placeholder {
        width: 36px;
        height: 36px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0.1)
        );
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .app-search-details {
        flex: 1;
      }

      .app-search-name {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
        color: #374151; /* gray-700 */
      }

      .app-search-version {
        font-size: 11px;
        opacity: 0.7;
      }

      .app-launch-btn {
        padding: 8px 16px;
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid rgba(76, 175, 80, 0.3);
        border-radius: 6px;
        color: white;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
      }

      .app-launch-btn:hover {
        background: rgba(76, 175, 80, 0.4);
        transform: scale(1.05);
      }

      .app-launch-btn .material-icons {
        font-size: 16px;
      }

      .no-results {
        text-align: center;
        padding: 20px;
        opacity: 0.7;
        font-size: 14px;
      }

      .window-details {
        flex: 1;
      }

      .window-main-info {
        margin-bottom: 4px;
        color: #374151; /* gray-700 */
      }

      .window-resource-usage {
        display: flex;
        gap: 12px;
        margin-top: 4px;
      }

      .resource-cpu,
      .resource-memory {
        font-size: 10px;
        font-weight: 600;
        padding: 2px 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: background 0.2s;
        border-radius: 4px;
        padding: 4px;
        margin: -4px;
      }

      .window-info:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .app-icon {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        object-fit: cover;
        flex-shrink: 0;
      }

      .app-icon-placeholder {
        width: 32px;
        height: 32px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0.1)
        );
        border-radius: 6px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: rgba(255, 255, 255, 0.7);
      }

      .app-icon-placeholder .material-icons {
        font-size: 20px;
        color: rgba(255, 255, 255, 0.6);
      }

      .state-badge {
        display: inline-block;
        padding: 2px 6px;
        margin-left: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .window-actions {
        display: flex;
        gap: 5px;
      }

      /* ウィンドウコントロールボタン - 統一されたスタイル */
      .window-ctrl-btn {
        padding: 6px 10px;
        background: rgba(0, 0, 0, 0.04);
        border: 1px solid rgba(0, 0, 0, 0.12);
        border-radius: 6px;
        color: #333;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        min-width: 32px;
        height: 32px;
        font-size: 11px;
      }

      .window-ctrl-btn .material-icons,
      .window-ctrl-btn .material-symbols-outlined {
        font-size: 16px;
        color: #111 !important;
      }

      .window-ctrl-btn:hover {
        background: rgba(0, 0, 0, 0.08);
        transform: translateY(-1px);
      }

      /* 閉じるボタン */
      .window-ctrl-btn.close {
        background: rgba(244, 67, 54, 0.2);
        border-color: rgba(244, 67, 54, 0.3);
        color: #111;
      }

      .window-ctrl-btn.close:hover {
        background: rgba(244, 67, 54, 0.4);
      }

      /* 最小化ボタン */
      .window-ctrl-btn.minimize {
        background: rgba(255, 193, 7, 0.2);
        border-color: rgba(255, 193, 7, 0.3);
        color: #111;
      }

      .window-ctrl-btn.minimize:hover {
        background: rgba(255, 193, 7, 0.4);
      }

      /* 最大化ボタン */
      .window-ctrl-btn.maximize {
        background: rgba(76, 175, 80, 0.2);
        border-color: rgba(76, 175, 80, 0.3);
        color: #111;
      }

      .window-ctrl-btn.maximize:hover {
        background: rgba(76, 175, 80, 0.4);
      }

      /* 終了ボタン */
      .window-ctrl-btn.quit {
        background: rgba(156, 39, 176, 0.2);
        border-color: rgba(156, 39, 176, 0.3);
        color: #111;
      }

      .window-ctrl-btn.quit:hover {
        background: rgba(156, 39, 176, 0.4);
      }

      /* アクティブ状態 */
      .window-ctrl-btn.active {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.4);
      }

      .log-section {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        padding: 15px;
        max-height: 200px;
        overflow-y: auto;
      }

      .log-entry {
        padding: 8px;
        margin-bottom: 5px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
        font-size: 12px;
        font-family: "Monaco", monospace;
      }

      .log-entry.success {
        border-left: 3px solid #4ade80;
      }

      .log-entry.error {
        border-left: 3px solid #f87171;
      }

      .log-entry.info {
        border-left: 3px solid #60a5fa;
      }

      .cpu-section {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .cpu-overview {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
      }

      .cpu-stat {
        text-align: center;
      }

      .cpu-label {
        font-size: 12px;
        opacity: 0.8;
        margin-bottom: 5px;
      }

      .cpu-value {
        font-size: 24px;
        font-weight: bold;
      }

      .cpu-model {
        text-align: center;
        opacity: 0.7;
        font-size: 12px;
        margin-bottom: 15px;
      }

      .cpu-processes {
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        padding-top: 15px;
      }

      .processes-header {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .process-item {
        padding: 8px 0;
        font-size: 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .process-item:last-child {
        border-bottom: none;
      }

      .process-main {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
      }

      .process-name {
        flex: 1;
        opacity: 0.9;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-weight: 500;
      }

      .process-stats {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .process-cpu {
        font-weight: 600;
        color: #fbbf24;
        min-width: 40px;
        text-align: right;
      }

      .process-memory {
        font-weight: 600;
        color: #60a5fa;
        min-width: 50px;
        text-align: right;
        font-size: 11px;
      }

      .process-description {
        font-size: 10px;
        opacity: 0.7;
        color: rgba(255, 255, 255, 0.8);
        margin-top: 2px;
        padding-left: 4px;
        border-left: 2px solid rgba(255, 255, 255, 0.2);
        font-style: italic;
        line-height: 1.3;
      }

      /* プリセット関連のスタイル */
      .preset-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px;
        margin-bottom: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        transition: all 0.2s;
      }

      .preset-item:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .preset-info {
        flex: 1;
      }

      .preset-name {
        font-weight: 600;
        margin-bottom: 2px;
        color: #374151; /* gray-700 */
      }

      .preset-details {
        font-size: 11px;
        color: #6b7280; /* gray-600: 白だと見えにくいため中間グレーに */
      }

      .preset-actions {
        display: flex;
        gap: 5px;
      }

      .preset-btn {
        padding: 6px 10px;
        background: rgba(0, 0, 0, 0.04);
        border: 1px solid rgba(0, 0, 0, 0.12);
        border-radius: 6px;
        color: #111;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
      }

      .preset-btn:hover {
        background: rgba(0, 0, 0, 0.08);
      }

      .preset-btn.load {
        background: rgba(33, 150, 243, 0.3);
        border-color: rgba(33, 150, 243, 0.5);
        color: #4b5563; /* gray-600 */
      }

      .preset-btn.load:hover {
        background: rgba(33, 150, 243, 0.5);
      }

      .preset-btn.delete {
        background: rgba(244, 67, 54, 0.3);
        border-color: rgba(244, 67, 54, 0.5);
        color: white;
      }

      .preset-btn.delete:hover {
        background: rgba(244, 67, 54, 0.5);
      }

      /* プリセット右側のボタン内アイコンを黒で視認性アップ */
      .preset-btn .material-icons,
      .preset-btn .material-symbols-outlined {
        color: #111 !important;
        opacity: 0.95;
      }

      /* ライトテーマ: 現在のウィンドウ右端の更新ボタンを視認性高く */
      #windowRefreshBtn {
        background: rgba(0, 0, 0, 0.04) !important;
        border: 1px solid rgba(0, 0, 0, 0.12) !important;
        color: #333 !important;
      }

      #windowRefreshBtn:hover {
        background: rgba(0, 0, 0, 0.08) !important;
      }

      .active-app-section {
        padding: 15px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 15px;
      }

      .active-app-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        color: rgba(255, 255, 255, 0.9);
      }

      .active-app-display {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 12px;
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      .active-app-name {
        font-size: 16px;
        font-weight: 600;
        color: #4ade80;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .active-app-name::before {
        content: "▶";
        font-size: 12px;
        color: #4ade80;
      }

      .stats-section {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stats-controls {
        display: flex;
        align-items: center;
        margin-left: auto;
      }

      .stats-content {
        margin-top: 15px;
      }

      .stats-summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-bottom: 20px;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .summary-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      .summary-label {
        font-size: 12px;
        opacity: 0.8;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #6b7280; /* gray-500 */
      }

      .summary-value {
        font-size: 20px;
        font-weight: bold;
        color: #4ade80;
      }

      .stats-table table {
        width: 100%;
        border-collapse: collapse;
      }

      .stats-table th {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        text-align: left;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        opacity: 0.8;
      }

      .stats-table td {
        padding: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 13px;
      }

      .stats-table .app-name {
        font-weight: 600;
      }

      .stats-table .focus-time {
        color: #4ade80;
        font-weight: 600;
      }

      .stats-table .session-count {
        color: #60a5fa;
      }

      .stats-table .avg-time {
        color: #fbbf24;
      }

      .stats-table .last-used {
        opacity: 0.7;
        font-size: 12px;
      }

      .data-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
      }

      .data-info-item {
        display: flex;
        justify-content: space-between;
        padding: 8px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
      }

      .data-info-label {
        opacity: 0.7;
      }

      .data-info-value {
        font-weight: 600;
        color: #4ade80;
      }

      /* 通知システム用スタイル */
      .notifications-section {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .notifications-controls {
        display: flex;
        align-items: center;
        margin-left: auto;
      }

      .notifications-content {
        margin-top: 15px;
      }

      .notifications-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .notification-summary-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 12px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      .notifications-list {
        max-height: 400px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        padding: 10px;
      }

      .notification-item {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 4px solid;
        transition: all 0.2s;
      }

      .notification-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .notification-item.unread {
        border-left-color: #4ade80;
        background: rgba(74, 222, 128, 0.1);
      }

      .notification-item.urgent {
        border-left-color: #ef4444;
      }

      .notification-item.high {
        border-left-color: #f59e0b;
      }

      .notification-item.medium {
        border-left-color: #3b82f6;
      }

      .notification-item.low {
        border-left-color: #6b7280;
      }

      .notification-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .notification-title {
        font-weight: 600;
        font-size: 14px;
      }

      .notification-time {
        font-size: 11px;
        opacity: 0.7;
      }

      .notification-message {
        font-size: 13px;
        margin-bottom: 10px;
        opacity: 0.9;
      }

      .notification-apps {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .notification-app {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        font-size: 12px;
      }

      .app-quit-btn {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 10px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .app-quit-btn:hover {
        background: rgba(239, 68, 68, 0.4);
      }

      .app-quit-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* モーダル用スタイル */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        max-height: 80%;
        overflow: hidden;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }

      .modal-header h3 {
        margin: 0;
        color: white;
      }

      .modal-close {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-body {
        padding: 20px;
        color: white;
      }

      .setting-group {
        margin-bottom: 20px;
      }

      .setting-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .setting-group select {
        width: 100%;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        font-size: 14px;
      }

      .setting-group input[type="checkbox"] {
        margin-right: 8px;
        transform: scale(1.2);
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        padding: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }

      .modal-footer button {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
      }

      #saveSettingsBtn {
        background: #4ade80;
        color: #065f46;
      }

      #cancelSettingsBtn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
      }

      .stats-charts {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
      }

      .chart-container {
        position: relative;
        height: 300px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .chart-container canvas {
        max-width: 100%;
        height: auto;
      }

      .stats-table {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding: 15px;
      }

      .stats-table-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        align-items: center;
      }

      .stats-table-row:last-child {
        border-bottom: none;
      }

      .stats-table-header {
        font-weight: bold;
        font-size: 12px;
        opacity: 0.8;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .stats-table-cell {
        font-size: 13px;
      }

      .stats-table-cell.app-name {
        font-weight: 600;
      }

      .stats-table-cell.time {
        color: #4ade80;
      }

      .stats-table-cell.sessions {
        color: #60a5fa;
      }

      .stats-table-cell.average {
        color: #fbbf24;
      }

      /* ダークモード対応 */
      @media (prefers-color-scheme: dark) {
        body {
          color: #e0e0e0;
        }

        /* 入力グループのボーダーは暗色背景で見えるよう白系に戻す */
        .input-group {
          border-color: rgba(255, 255, 255, 0.25);
          background: rgba(255, 255, 255, 0.12);
        }

        /* ボタンのコントラストをダーク時に白系へ */
        .window-ctrl-btn,
        .preset-btn,
        .app-info-btn {
          background: rgba(255, 255, 255, 0.15);
          border-color: rgba(255, 255, 255, 0.25);
          color: #e0e0e0;
        }

        .window-ctrl-btn:hover,
        .preset-btn:hover,
        .app-info-btn:hover {
          background: rgba(255, 255, 255, 0.25);
        }

        .header {
          background: rgba(30, 30, 30, 0.95);
        }

        .header h1 {
          color: #e0e0e0;
        }

        .header p {
          color: #aaa;
        }

        .main-content {
          background: rgba(30, 30, 30, 0.95);
        }

        .input-section,
        .status-section,
        .notifications-section,
        .cpu-section,
        .stats-section {
          background: rgba(30, 30, 30, 0.8);
          border-color: rgba(255, 255, 255, 0.1);
        }

        .status-title {
          color: #e0e0e0;
        }

        #userIntent {
          background: rgba(40, 40, 40, 0.95);
          color: #e0e0e0;
        }

        #userIntent::placeholder {
          color: #777;
        }

        .quick-action {
          background: rgba(40, 40, 40, 0.8);
          color: #e0e0e0;
          border-color: rgba(255, 255, 255, 0.1);
        }

        .quick-action:hover {
          background: rgba(255, 255, 255, 0.2);
        }

        button {
          background: #111;
        }

        button:hover {
          background: #000;
        }

        /* ダークテーマでは更新ボタンを白系のまま */
        #windowRefreshBtn {
          background: rgba(255, 255, 255, 0.15) !important;
          border-color: rgba(255, 255, 255, 0.25) !important;
          color: white !important;
        }

        #windowRefreshBtn:hover {
          background: rgba(255, 255, 255, 0.25) !important;
        }
      }
    </style>
  </head>
  <body>
    <button
      class="reset-button"
      onclick="resetLocalData()"
      title="データをリセット"
    >
      <span class="material-icons">delete_forever</span>
      リセット
    </button>

    <div class="header">
      <h1><span class="material-icons">window</span> tottonoe</h1>
      <p>ひと呼吸で、快適な作業場を</p>
    </div>

    <!-- Preset Restore Dialog (close non-included apps) -->
    <div
      id="presetRestoreDialog"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1700;
        backdrop-filter: blur(5px);
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: #ffffff;
          border: 1px solid rgba(0, 0, 0, 0.08);
          border-radius: 12px;
          padding: 20px;
          min-width: 440px;
          max-width: 640px;
          max-height: 80vh;
          overflow-y: auto;
          box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        "
      >
        <h3 style="margin-bottom: 12px; font-size: 18px; font-weight: 600">
          <span
            class="material-icons"
            style="vertical-align: middle; margin-right: 6px"
            >playlist_remove</span
          >
          プリセット外のアプリを閉じますか？
        </h3>
        <div
          id="presetRestoreMessage"
          style="font-size: 13px; opacity: 0.9; margin-bottom: 10px"
        ></div>
        <div
          id="presetRestoreAppList"
          style="max-height: 260px; overflow-y: auto; margin: 8px 0 16px"
        ></div>
        <div style="display: flex; gap: 8px; justify-content: flex-end">
          <button
            onclick="restoreWithoutClosing()"
            style="
              background: rgba(0, 0, 0, 0.06);
              color: #374151;
              border: 1px solid #d1d5db;
            "
          >
            閉じずに復元
          </button>
          <button
            onclick="closeSelectedAndRestore()"
            style="background: #ef4444; color: white; border: none"
          >
            選択したアプリを閉じて復元
          </button>
          <button
            onclick="cancelPresetRestoreDialog()"
            style="
              background: transparent;
              color: #374151;
              border: 1px solid #d1d5db;
            "
          >
            キャンセル
          </button>
        </div>
      </div>
    </div>

    <div class="main-content">
      <!-- Task-based App Launcher (Refined UI) -->
      <div class="input-section" style="margin-bottom: 20px">
        <div class="status-title" style="margin-bottom: 15px">
          <span class="material-icons" style="font-size: 18px"
            >auto_awesome</span
          >
          タスクから最適なアプリを起動
        </div>
        <div class="input-group">
          <div class="input-with-icon">
            <span class="material-icons">search</span>
            <input
              type="text"
              id="taskPromptInput"
              placeholder="やりたいことを入力 (例: ウェブ開発する、動画編集する)"
              autocomplete="off"
            />
          </div>
          <button
            id="suggestAppsBtn"
            class="inline-action-btn"
            type="button"
            onclick="suggestAppsForTask()"
          >
            <span class="material-icons">auto_fix_high</span> 提案
          </button>
        </div>
      </div>

      <div class="input-section">
        <div class="status-title" style="margin-bottom: 10px">
          <span class="material-icons" style="font-size: 18px"
            >dashboard_customize</span
          >
          ウィンドウ配置アシスト
        </div>
        <p class="section-subtitle">
          テキストでレイアウト指示 → AIが配置・移動・サイズ変更
        </p>
        <div class="input-group">
          <div class="input-with-icon">
            <span class="material-icons">edit_note</span>
            <input
              type="text"
              id="userIntent"
              placeholder="例: Safariを左側、VSCodeを右側に配置して"
            />
          </div>
          <button id="analyzeBtn" class="inline-action-btn">
            <span class="material-icons">auto_fix_high</span> 分析・実行
          </button>
        </div>

        <!-- すべてのアプリを閉じるボタンは削除 -->

        <!-- プリセット機能 -->
        <div class="preset-section" style="margin-top: 20px">
          <div class="status-title" style="margin-bottom: 15px">
            <span class="material-icons" style="font-size: 18px">bookmark</span>
            ウィンドウ配置プリセット
          </div>

          <!-- プリセット保存行は削除。保存トリガーは「現在のウィンドウ」見出し側に配置 -->

          <!-- プリセット一覧 -->
          <div id="presetList" style="max-height: 200px; overflow-y: auto">
            <!-- プリセットアイテムがここに表示されます -->
          </div>
        </div>

        <!-- ウィンドウ配置アクション -->
        <div class="quick-actions">
          <button class="quick-action" data-intent="開発に集中できるようにして">
            <span class="material-icons">code</span> 開発集中
          </button>
          <button class="quick-action" data-intent="作業用レイアウトにして">
            <span class="material-icons">dashboard</span> 作業用
          </button>
          <button class="quick-action" data-intent="2画面に分割して">
            <span class="material-icons">splitscreen</span> 2分割
          </button>
          <button
            class="quick-action"
            data-intent="すべてのウィンドウをグリッド表示"
          >
            <span class="material-icons">grid_view</span> グリッド
          </button>
          <button
            class="quick-action"
            data-intent="コミュニケーションアプリを整理して"
          >
            <span class="material-icons">chat</span> コミュニケーション
          </button>
          <button
            class="quick-action"
            data-intent="おまかせで最適化して"
            style="
              background: linear-gradient(135deg, #06beb6 0%, #48b1bf 100%);
              color: white;
              border: none;
            "
          >
            <span class="material-icons">auto_awesome</span> おまかせ
          </button>
        </div>
      </div>

      <!-- AI通知・提案セクション -->
      <div class="notifications-section">
        <div class="status-title">
          <span class="status-indicator"></span>
          <span class="material-icons" style="font-size: 18px"
            >notifications</span
          >
          AI分析・通知履歴
          <div class="notifications-controls">
            <button
              id="notificationSettingsBtn"
              style="padding: 4px 8px; font-size: 11px; margin-right: 8px"
            >
              設定
            </button>
            <button
              id="refreshNotificationsBtn"
              style="padding: 4px 8px; font-size: 11px"
            >
              更新
            </button>
          </div>
        </div>

        <div class="notifications-content">
          <div id="notificationsSummary" class="notifications-summary">
            <!-- 通知サマリーがここに生成される -->
          </div>

          <div class="notifications-list" id="notificationsList">
            <!-- 通知履歴がここに生成される -->
          </div>
        </div>

        <!-- 設定モーダル -->
        <div id="notificationSettingsModal" class="modal" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h3>AI分析・通知設定</h3>
              <button class="modal-close" id="closeSettingsModal">
                &times;
              </button>
            </div>
            <div class="modal-body">
              <div class="setting-group">
                <label>分析実行間隔:</label>
                <select id="analysisIntervalSelect">
                  <option value="0">無効</option>
                  <option value="60000">1分</option>
                  <option value="300000">5分</option>
                  <option value="900000">15分</option>
                  <option value="1800000">30分</option>
                  <option value="3600000">1時間</option>
                </select>
              </div>
              <div class="setting-group">
                <label>
                  <input type="checkbox" id="enableNotifications" />
                  AI分析結果の通知を有効にする
                </label>
              </div>
              <div class="setting-group">
                <label>
                  <input type="checkbox" id="enableSystemNotifications" />
                  macOSシステム通知を有効にする
                </label>
              </div>
            </div>
            <div class="modal-footer">
              <button id="saveSettingsBtn">保存</button>
              <button id="cancelSettingsBtn">キャンセル</button>
            </div>
          </div>
        </div>
      </div>

      <div class="cpu-section">
        <div class="status-title">
          <span class="status-indicator"></span>
          システム情報
          <button
            id="cpuRefreshBtn"
            style="margin-left: auto; padding: 4px 8px; font-size: 11px"
          >
            更新
          </button>
        </div>

        <!-- アクティブアプリ表示 -->
        <div class="active-app-section">
          <div class="active-app-title">
            <span
              class="material-icons"
              style="font-size: 16px; margin-right: 8px"
              >touch_app</span
            >
            アクティブアプリ
          </div>
          <div id="activeAppInfo" class="active-app-display">
            <div class="active-app-name">取得中...</div>
          </div>
        </div>

        <div id="cpuInfo">
          <!-- CPU info will be populated here -->
        </div>
      </div>

      <div class="status-section">
        <div class="status-title">
          <span class="status-indicator"></span>
          <span class="material-icons" style="font-size: 18px"
            >desktop_windows</span
          >
          現在のウィンドウ
          <div
            style="
              margin-left: auto;
              display: flex;
              gap: 8px;
              align-items: center;
            "
          >
            <button
              id="selectAllWindowsBtn"
              class="preset-btn"
              style="padding: 6px 10px"
            >
              全選択
            </button>
            <button
              id="openSavePresetDialogBtn"
              class="preset-btn load"
              style="padding: 6px 10px"
            >
              <span class="material-icons" style="font-size: 16px"
                >bookmark_add</span
              >
              保存
            </button>
            <label
              style="
                display: flex;
                align-items: center;
                font-size: 12px;
                gap: 4px;
              "
            >
              <input
                type="checkbox"
                id="autoRefreshCheckbox"
                style="cursor: pointer"
              />
              <span>自動更新</span>
            </label>
            <button
              id="windowRefreshBtn"
              style="
                padding: 4px 8px;
                font-size: 11px;
                background: rgba(255, 255, 255, 0.15);
                border: 1px solid rgba(255, 255, 255, 0.25);
                border-radius: 4px;
                color: white;
                cursor: pointer;
              "
            >
              <span
                class="material-icons"
                style="font-size: 14px; vertical-align: middle"
                >refresh</span
              >
              更新
            </button>
          </div>
        </div>
        <!-- Bulk action bar (hidden when no selection) -->
        <div
          id="bulkActionBar"
          style="
            display: none;
            margin: 8px 0 12px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: none;
            align-items: center;
            gap: 10px;
          "
        >
          <span id="bulkCountText" style="font-size: 13px"
            >0個のウィンドウ</span
          >
          <div style="margin-left: auto; display: flex; gap: 8px">
            <button
              id="bulkCloseBtn"
              class="window-ctrl-btn close"
              title="閉じる"
            >
              <span class="material-icons">close</span> 閉じる
            </button>
            <button
              id="bulkMinimizeBtn"
              class="window-ctrl-btn minimize"
              title="最小化"
            >
              <span class="material-icons">minimize</span> 最小化
            </button>
            <button id="bulkQuitBtn" class="window-ctrl-btn quit" title="終了">
              <span class="material-icons">power_settings_new</span> 終了
            </button>
          </div>
        </div>
        <div class="window-list" id="windowList">
          <!-- Windows will be populated here -->
        </div>
      </div>

      <!-- フォーカス統計セクション -->
      <div class="stats-section">
        <div class="status-title">
          <span class="status-indicator"></span>
          <span class="material-icons" style="font-size: 18px">analytics</span>
          アプリ使用統計
          <div class="stats-controls">
            <select
              id="timeRange"
              style="
                margin-right: 8px;
                padding: 2px 4px;
                font-size: 11px;
                background: rgba(255, 255, 255, 0.1);
                color: white;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 4px;
              "
            >
              <option value="today">今日</option>
              <option value="week">今週</option>
              <option value="month">今月</option>
              <option value="all">全期間</option>
            </select>
            <button
              id="statsRefreshBtn"
              style="padding: 4px 8px; font-size: 11px"
            >
              更新
            </button>
          </div>
        </div>

        <div class="stats-content">
          <div id="statsSummary" class="summary-grid">
            <!-- サマリー統計がここに生成される -->
          </div>

          <div class="stats-charts">
            <div class="chart-container">
              <h4
                style="text-align: center; margin-bottom: 15px; font-size: 14px"
              >
                アプリ別使用時間
              </h4>
              <canvas id="focusChart" width="400" height="250"></canvas>
            </div>
          </div>

          <div class="stats-table">
            <h4 style="margin-bottom: 10px; font-size: 14px">詳細統計</h4>
            <div id="statsTable">
              <!-- 統計テーブルがここに生成される -->
            </div>
          </div>

          <div
            id="dataInfo"
            style="
              margin-top: 15px;
              padding-top: 15px;
              border-top: 1px solid rgba(255, 255, 255, 0.2);
              font-size: 12px;
            "
          >
            <!-- データ情報がここに生成される -->
          </div>
        </div>
      </div>

      <div class="log-section">
        <div id="logContainer">
          <div class="log-entry info">Window AI Manager 起動完了</div>
        </div>
      </div>
    </div>

    <!-- App Info Modal -->
    <div
      id="appInfoModal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        backdrop-filter: blur(3px);
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 12px;
          padding: 20px;
          min-width: 350px;
          max-width: 500px;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h3
            id="appInfoTitle"
            style="margin: 0; font-size: 18px; font-weight: 600"
          ></h3>
          <button
            onclick="closeAppInfoModal()"
            style="
              background: transparent;
              border: none;
              color: white;
              cursor: pointer;
              padding: 4px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="material-icons">close</span>
          </button>
        </div>
        <div id="appInfoContent" style="">
          <!-- Observations will be listed here -->
        </div>
      </div>
    </div>

    <!-- AI Optimization Dialog -->
    <div
      id="aiOptimizationDialog"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        backdrop-filter: blur(5px);
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: #ffffff;
          border: 1px solid rgba(0, 0, 0, 0.08);
          border-radius: 12px;
          padding: 20px;
          min-width: 450px;
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
          box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        "
      >
        <h2 style="margin-bottom: 16px; font-size: 20px; font-weight: 600">
          <span
            class="material-icons"
            style="vertical-align: middle; margin-right: 8px"
            >auto_awesome</span
          >
          AI最適化の提案
        </h2>

        <!-- System Health Score -->
        <div
          style="
            margin-bottom: 20px;
            padding: 12px;
            background: #f5f5f5;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <span style="font-size: 14px; opacity: 0.9">システム健康度</span>
            <span
              id="systemHealthScore"
              style="font-size: 24px; font-weight: bold"
            ></span>
          </div>
          <div
            style="
              margin-top: 8px;
              background: #e5e7eb;
              border-radius: 4px;
              height: 8px;
              overflow: hidden;
            "
          >
            <div
              id="healthScoreBar"
              style="
                height: 100%;
                background: #06beb6;
                transition: width 0.3s ease;
              "
            ></div>
          </div>
        </div>

        <!-- Overall Assessment -->
        <div
          id="overallAssessment"
          style="
            margin-bottom: 20px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
          "
        ></div>

        <!-- Window Layout Recommendations -->
        <div
          id="windowLayoutSection"
          style="
            display: none;
            margin-bottom: 20px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 8px;
          "
        >
          <h3 style="font-size: 16px; margin-bottom: 12px; opacity: 0.9">
            <span
              class="material-icons"
              style="font-size: 18px; vertical-align: middle; margin-right: 4px"
              >grid_view</span
            >
            ウィンドウ配置の提案
          </h3>
          <div
            id="layoutRecommendations"
            style="font-size: 14px; line-height: 1.6"
          >
            <!-- Layout recommendations will be shown here -->
          </div>
        </div>

        <!-- Apps to Close Recommendations -->
        <div id="appsToCloseList" style="margin-bottom: 20px">
          <h3 style="font-size: 16px; margin-bottom: 12px; opacity: 0.9">
            <span
              class="material-icons"
              style="font-size: 18px; vertical-align: middle; margin-right: 4px"
              >close_fullscreen</span
            >
            閉じることを推奨するアプリ
          </h3>
          <div
            style="
              margin-bottom: 8px;
              padding: 8px;
              background: #f5f5f5;
              border-radius: 6px;
            "
          >
            <label
              style="
                display: flex;
                align-items: center;
                cursor: pointer;
                font-size: 13px;
              "
            >
              <input
                type="checkbox"
                id="selectAllApps"
                style="margin-right: 8px"
                checked
              />
              <span>すべて選択 / 解除</span>
            </label>
          </div>
          <div
            id="appsRecommendations"
            style="max-height: 300px; overflow-y: auto"
          >
            <!-- Recommendations will be dynamically added here -->
          </div>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end">
          <button
            onclick="cancelAIOptimization()"
            style="
              background: transparent;
              color: #374151;
              border: 1px solid #d1d5db;
            "
          >
            <span class="material-icons">cancel</span> キャンセル
          </button>
          <button
            onclick="confirmAIOptimization()"
            style="
              background: #06beb6;
              color: #ffffff;
              font-weight: 600;
              border: none;
            "
          >
            <span class="material-icons">check_circle</span> 実行する
          </button>
        </div>
      </div>
    </div>

    <!-- Close All Apps Dialog -->
    <div
      id="closeAllAppsDialog"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        backdrop-filter: blur(5px);
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: #ffffff;
          border: 1px solid rgba(0, 0, 0, 0.08);
          border-radius: 12px;
          padding: 24px;
          min-width: 400px;
          max-width: 600px;
          max-height: 80vh;
          overflow-y: auto;
          box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        "
      >
        <h2 style="margin-bottom: 16px; font-size: 20px; font-weight: 600">
          <span
            class="material-icons"
            style="vertical-align: middle; margin-right: 8px"
            >warning</span
          >
          アプリケーションを閉じる
        </h2>
        <p style="margin-bottom: 20px; opacity: 0.9; font-size: 14px">
          閉じたくないアプリケーションにチェックを入れてください。
          チェックされていないアプリケーションはすべて終了されます。
        </p>
        <div id="appCheckboxList" style="margin-bottom: 20px">
          <!-- App checkboxes will be dynamically added here -->
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end">
          <button
            onclick="cancelCloseAllApps()"
            style="
              background: transparent;
              color: #374151;
              border: 1px solid #d1d5db;
            "
          >
            <span class="material-icons">cancel</span> キャンセル
          </button>
          <button
            onclick="confirmCloseAllApps()"
            style="background: #ef4444; color: white"
          >
            <span class="material-icons">check_circle</span> 閉じる
          </button>
        </div>
      </div>
    </div>

    <!-- Task App Suggestion Dialog -->
    <!-- Save Preset Dialog -->
    <div
      id="savePresetDialog"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1500;
        backdrop-filter: blur(6px);
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: linear-gradient(135deg, #1f2937 0%, #0f172a 100%);
          border-radius: 14px;
          padding: 20px;
          min-width: 420px;
          max-width: 520px;
          border: 1px solid rgba(255, 255, 255, 0.15);
        "
      >
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
          "
        >
          <h3
            style="margin: 0; font-size: 16px; font-weight: 600; color: white"
          >
            <span
              class="material-icons"
              style="
                font-size: 18px;
                vertical-align: middle;
                margin-right: 6px;
                color: #22c55e;
              "
              >bookmark_add</span
            >
            プリセットとして保存
          </h3>
          <button
            onclick="closeSavePresetDialog()"
            style="
              background: none;
              border: none;
              color: rgba(255, 255, 255, 0.8);
              cursor: pointer;
            "
          >
            <span class="material-icons">close</span>
          </button>
        </div>
        <div class="input-group">
          <div class="input-with-icon" style="flex: 1">
            <span class="material-icons">edit</span>
            <input
              id="savePresetNameInput"
              type="text"
              placeholder="プリセット名"
              autocomplete="off"
            />
          </div>
          <button
            class="inline-success-btn"
            type="button"
            onclick="confirmSavePresetFromDialog()"
          >
            <span class="material-icons">save</span> 保存
          </button>
        </div>
      </div>
    </div>
    <div
      id="taskAppDialog"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        backdrop-filter: blur(8px);
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
          border-radius: 16px;
          padding: 24px;
          min-width: 500px;
          max-width: 700px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
          border: 1px solid rgba(255, 255, 255, 0.1);
        "
      >
        <!-- Header -->
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
          "
        >
          <h2
            style="margin: 0; font-size: 20px; font-weight: 600; color: white"
          >
            <span
              class="material-icons"
              style="vertical-align: middle; margin-right: 8px; color: #a78bfa"
              >auto_awesome</span
            >
            タスクに最適なアプリを選択
          </h2>
          <button
            onclick="closeTaskAppDialog()"
            style="
              background: none;
              border: none;
              color: rgba(255, 255, 255, 0.6);
              cursor: pointer;
              padding: 4px;
            "
          >
            <span class="material-icons">close</span>
          </button>
        </div>

        <!-- Task Name Input -->
        <div style="margin-bottom: 20px">
          <label
            style="
              display: block;
              margin-bottom: 8px;
              color: rgba(255, 255, 255, 0.9);
              font-size: 14px;
            "
          >
            タスク名（プリセット名として保存されます）
          </label>
          <input
            type="text"
            id="taskNameInput"
            style="
              width: 100%;
              padding: 10px;
              background: rgba(255, 255, 255, 0.1);
              border: 1px solid rgba(255, 255, 255, 0.2);
              border-radius: 8px;
              color: white;
            "
            placeholder="例: ウェブ開発"
          />
        </div>

        <!-- Loading State -->
        <div
          id="taskAppLoading"
          style="display: none; text-align: center; padding: 40px"
        >
          <div class="spinner" style="margin: 0 auto 16px"></div>
          <p style="color: rgba(255, 255, 255, 0.8)">最適なアプリを分析中...</p>
        </div>

        <!-- App Selection List -->
        <div id="taskAppContent" style="display: none">
          <div style="margin-bottom: 16px">
            <p
              id="taskReasoningText"
              style="
                color: rgba(255, 255, 255, 0.8);
                font-size: 14px;
                margin-bottom: 16px;
                padding: 12px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
                border-left: 3px solid #a78bfa;
              "
            ></p>
          </div>

          <!-- High Confidence Apps -->
          <div style="margin-bottom: 16px">
            <h3
              style="
                font-size: 14px;
                font-weight: 600;
                color: rgba(255, 255, 255, 0.9);
                margin-bottom: 8px;
              "
            >
              <span
                class="material-icons"
                style="font-size: 16px; vertical-align: middle; color: #4ade80"
                >check_circle</span
              >
              推奨アプリ
            </h3>
            <div
              id="highConfidenceApps"
              style="max-height: 160px; overflow-y: auto; padding: 4px"
            >
              <!-- High confidence apps will be inserted here -->
            </div>
          </div>

          <!-- Low Confidence Apps -->
          <div style="margin-bottom: 16px">
            <h3
              style="
                font-size: 14px;
                font-weight: 600;
                color: rgba(255, 255, 255, 0.9);
                margin-bottom: 8px;
              "
            >
              <span
                class="material-icons"
                style="font-size: 16px; vertical-align: middle; color: #fbbf24"
                >help_outline</span
              >
              追加候補
            </h3>
            <div
              id="lowConfidenceApps"
              style="max-height: 120px; overflow-y: auto; padding: 4px"
            >
              <!-- Low confidence apps will be inserted here -->
            </div>
          </div>

          <!-- Search Additional Apps -->
          <div style="margin-bottom: 16px">
            <h3
              style="
                font-size: 14px;
                font-weight: 600;
                color: rgba(255, 255, 255, 0.9);
                margin-bottom: 8px;
              "
            >
              <span
                class="material-icons"
                style="font-size: 16px; vertical-align: middle"
                >add_circle</span
              >
              アプリを追加
            </h3>
            <div style="display: flex; gap: 8px; margin-bottom: 8px">
              <input
                type="text"
                id="additionalAppSearch"
                placeholder="アプリ名を検索"
                style="
                  flex: 1;
                  padding: 8px;
                  background: rgba(255, 255, 255, 0.1);
                  border: 1px solid rgba(255, 255, 255, 0.2);
                  border-radius: 6px;
                  color: white;
                  font-size: 14px;
                "
              />
              <button
                onclick="searchAdditionalApps()"
                style="
                  padding: 8px 16px;
                  background: rgba(255, 255, 255, 0.15);
                  border: 1px solid rgba(255, 255, 255, 0.25);
                  border-radius: 6px;
                  color: white;
                  cursor: pointer;
                "
              >
                <span
                  class="material-icons"
                  style="font-size: 16px; vertical-align: middle"
                  >search</span
                >
              </button>
            </div>
            <div
              id="additionalAppResults"
              style="max-height: 80px; overflow-y: auto; padding: 4px"
            >
              <!-- Search results will appear here -->
            </div>
          </div>

          <!-- Action Buttons -->
          <div style="display: flex; gap: 12px; justify-content: flex-end">
            <button
              onclick="closeTaskAppDialog()"
              style="
                padding: 10px 20px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                color: white;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
              "
            >
              キャンセル
            </button>
            <button
              onclick="confirmTaskApps()"
              style="
                padding: 10px 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: none;
                border-radius: 8px;
                color: white;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
              "
            >
              <span
                class="material-icons"
                style="
                  font-size: 16px;
                  vertical-align: middle;
                  margin-right: 4px;
                "
                >rocket_launch</span
              >
              選択したアプリを起動
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="renderer.js"></script>
  </body>
</html>
